# PDF Content Bookmark Generator

PDF Content Bookmark Generator 是一个用于为PDF文件添加内容书签（目录）的工具。它提供了一个基于Web的用户界面，让用户可以轻松地解析目录文本、编辑书签并生成带书签的PDF文件。

## 功能特点

- 基于Web的图形用户界面
- 提供目录页提取工具（需要用户自行输入目录页范围）
- 需要用户利用外部工具获取目录文本信息
- 智能目录文本解析，支持多种格式
- 可视化书签编辑器，支持拖拽排序
- 支持多级书签层级结构
- 页码偏移量自动计算和应用
- 目录页提取和预览功能
- 草稿自动保存和恢复
- 支持批量操作和搜索功能

## 技术架构

本项目采用模块化设计，主要包含以下组件：

```
Pdf_ContentBookmark_Generator/
├── core/                     # 核心功能模块
│   └── bookmark_generator.py # 书签生成核心逻辑
├── handlers/                 # 请求处理模块
│   └── request_handler.py    # HTTP请求处理
├── ui/                       # 用户界面组件
│   └── components.py         # HTML模板和UI组件
├── utils/                    # 工具函数模块
│   └── helpers.py            # 辅助函数
├── main.py                   # 程序入口点
└── README.md                 # 说明文档
```

### 模块说明

1. **core/bookmark_generator.py** - 核心业务逻辑
   - PDF书签解析、管理、PDF生成等核心功能
   - 书签的增删改查操作
   - 偏移量计算和应用

2. **handlers/request_handler.py** - HTTP请求处理
   - 处理所有GET和POST请求
   - 路由分发
   - 与前端的数据交互

3. **ui/components.py** - UI界面
   - HTML模板
   - CSS样式和JavaScript交互逻辑

4. **utils/helpers.py** - 工具函数
   - 通用的辅助函数
   - 文件操作、数据处理等

5. **main.py** - 程序入口
   - 启动HTTP服务器
   - 初始化各模块

## 系统要求

- Python 3.6 或更高版本
- 依赖库：
  - PyPDF2 (用于PDF处理)
  - pdf2image (可选，用于目录页提取)
  - Pillow (可选，用于图片处理)

## 安装依赖

```bash
pip install PyPDF2
pip install pdf2image  # 可选
pip install Pillow     # 可选
```

注意：如果要使用pdf2image，还需要安装系统级依赖：
- Windows: 安装 [Poppler for Windows](http://blog.alivate.com.au/poppler-windows/)
- macOS: `brew install poppler`
- Linux: `sudo apt-get install poppler-utils`

## 使用方法

1. 克隆或下载本项目
2. 安装所需依赖
3. 运行主程序：
   ```bash
   python main.py
   ```
4. 在浏览器中打开 `http://localhost:8083`
5. 按照界面提示操作

## 使用步骤

1. **上传PDF文件**
   - 点击"选择PDF文件"按钮选择要添加书签的PDF文件
   - 点击"上传PDF"按钮上传文件

2. **提取目录页**（可选）
   - 设置目录起始页和结束页
   - 点击"提取目录页"按钮查看目录页图片
   - 可自行使用OCR工具或AI工具识别目录内容
   - 提供了一键跳转通义千问，和支持一键复制的预设提示词

3. **输入目录文本**
   - 在文本框中粘贴目录内容
   - 点击"解析目录"按钮自动解析书签

4. **设置参数**
   - 设置正文起始页以自动计算页码偏移量
   - 或手动设置偏移量
   - 设置输出文件名（默认读取输入文件名_bookmarked）

5. **编辑书签**
   - 在表格中编辑书签标题、页码和层级
   - 使用拖拽功能调整书签顺序
   - 支持批量操作和搜索功能

6. **生成PDF**
   - 点击"生成PDF"按钮创建带书签的PDF文件
   - 文件默认保存到用户文档目录下的"pdf编目"文件夹中（下一步增加自定义输出目录功能）

## 目录格式支持

工具支持多种目录格式，包括：

1. 基本格式：
   ```
   第一章 引言 ...................... 1
   第二章 背景 ...................... 5
   ```

2. 编号格式：
   ```
   1. 引言 ...................... 1
   2. 背景 ...................... 5
   ```

3. Markdown格式：
   ```
   # 第一章 引言 1
   ## 1.1 背景介绍 1
   ## 1.2 研究意义 3
   ```

4. 缩进格式：
   ```
   第一章 引言 1
     1.1 背景介绍 1
     1.2 研究意义 3
   ```

## 常见问题

### 1. 页码不正确怎么办？
- 检查正文起始页设置是否正确
- 手动调整偏移量
- 在书签编辑器中直接修改页码

### 2. 无法提取目录页？
- 确认已安装pdf2image和Pillow库
- 确认已安装系统级依赖Poppler
- 检查PDF文件是否有效

### 3. 目录解析不准确？
- 检查目录文本格式是否规范
- 手动在书签编辑器中调整解析结果
- 使用预览功能确认解析结果

## 版本历史

- v1.0: 基础功能实现
- v2.0: 增加Web界面
- v3.0: 改进目录解析算法
- v4.0: 模块化重构，优化用户体验

## 许可证

本项目基于MIT许可证发布。

## 联系方式

如有问题或建议，请联系项目维护者。
